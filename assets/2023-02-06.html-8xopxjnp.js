import{_ as p,r as c,o as l,c as i,e as a,w as t,a as s,d as n,b as u}from"./app-EJyl-AbL.js";const k="/assets/2023-02-06-1-OaKSmQfG.png",r="/assets/2023-02-06-2-a_zYGUDl.jpg",d="/assets/2023-02-06-3-k-Cu8PjE.jpg",g={},m=s("h1",{id:"灰机wiki的html模板安全问题",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#灰机wiki的html模板安全问题","aria-hidden":"true"},"#"),n(" 灰机wiki的HTML模板安全问题")],-1),_=s("p",null,"因为最近想要向js代码中传递一些参数，所以稍微多考虑了一下安全性问题，专门测试了一下参数传递中可能出现的问题。",-1),v=s("div",{class:"language-wiki line-numbers-mode","data-ext":"wiki"},[s("pre",{class:"language-wiki"},[s("code",null,[n(`{{#html:Html:用户:宋礼/沙盒
`),s("span",{class:"token punctuation"},"|"),n(` {
"漏洞测试1":"\\">`),s("span",{class:"token tag"},[s("span",{class:"token tag"},[s("span",{class:"token punctuation"},"<"),n("script")]),s("span",{class:"token punctuation"},">")]),s("span",{class:"token script"},[s("span",{class:"token language-javascript"},[s("span",{class:"token function"},"alert"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},"'你被攻击了1'"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},";")])]),s("span",{class:"token tag"},[s("span",{class:"token tag"},[s("span",{class:"token punctuation"},"</"),n("script")]),s("span",{class:"token punctuation"},">")]),n(`<\\/div><div id=\\"",
"漏洞测试2":"\\">`),s("span",{class:"token tag"},[s("span",{class:"token tag"},[s("span",{class:"token punctuation"},"<"),n("script")]),s("span",{class:"token punctuation"},">")]),s("span",{class:"token script"},[s("span",{class:"token language-javascript"},[s("span",{class:"token function"},"alert"),s("span",{class:"token punctuation"},"("),s("span",{class:"token string"},"'你被攻击了2'"),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},";")])]),s("span",{class:"token tag"},[s("span",{class:"token tag"},[s("span",{class:"token punctuation"},"</"),n("script")]),s("span",{class:"token punctuation"},">")]),n('<\\/div><div id=\\"",\n"漏洞测试3":"${'),s("span",{class:"token url"},"['这是用','JS代码','连在一起的句子1']"),n(`.join('……')}",
"漏洞测试4":"\${`),s("span",{class:"token url"},"['这是用','JS代码','连在一起的句子2']"),n(`.join('……')}"
} }}
`)])]),s("div",{class:"line-numbers","aria-hidden":"true"},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),b=s("div",{class:"language-html line-numbers-mode","data-ext":"html"},[s("pre",{class:"language-html"},[s("code",null,[s("span",{class:"token tag"},[s("span",{class:"token tag"},[s("span",{class:"token punctuation"},"<"),n("div")]),n(),s("span",{class:"token attr-name"},"id"),s("span",{class:"token attr-value"},[s("span",{class:"token punctuation attr-equals"},"="),s("span",{class:"token punctuation"},'"'),n("data"),s("span",{class:"token punctuation"},'"')]),n(),s("span",{class:"token special-attr"},[s("span",{class:"token attr-name"},"style"),s("span",{class:"token attr-value"},[s("span",{class:"token punctuation attr-equals"},"="),s("span",{class:"token punctuation"},'"'),s("span",{class:"token value css language-css"},[s("span",{class:"token property"},"display"),s("span",{class:"token punctuation"},":"),n("none")]),s("span",{class:"token punctuation"},'"')])]),n(),s("span",{class:"token attr-name"},"bug-test1"),s("span",{class:"token attr-value"},[s("span",{class:"token punctuation attr-equals"},"="),s("span",{class:"token punctuation"},'"'),n("{{{漏洞测试1}}}"),s("span",{class:"token punctuation"},'"')]),n(),s("span",{class:"token attr-name"},"bug-test2"),s("span",{class:"token attr-value"},[s("span",{class:"token punctuation attr-equals"},"="),s("span",{class:"token punctuation"},'"'),n("{{漏洞测试2}}"),s("span",{class:"token punctuation"},'"')]),s("span",{class:"token punctuation"},">")]),s("span",{class:"token tag"},[s("span",{class:"token tag"},[s("span",{class:"token punctuation"},"</"),n("div")]),s("span",{class:"token punctuation"},">")]),n(`
`),s("span",{class:"token tag"},[s("span",{class:"token tag"},[s("span",{class:"token punctuation"},"<"),n("script")]),s("span",{class:"token punctuation"},">")]),s("span",{class:"token script"},[s("span",{class:"token language-javascript"},[n(`
    console`),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"log"),s("span",{class:"token punctuation"},"("),s("span",{class:"token template-string"},[s("span",{class:"token template-punctuation string"},"`"),s("span",{class:"token string"},"{{{漏洞测试3}}}"),s("span",{class:"token template-punctuation string"},"`")]),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},";"),n(`
    console`),s("span",{class:"token punctuation"},"."),s("span",{class:"token function"},"log"),s("span",{class:"token punctuation"},"("),s("span",{class:"token template-string"},[s("span",{class:"token template-punctuation string"},"`"),s("span",{class:"token string"},"{{漏洞测试4}}"),s("span",{class:"token template-punctuation string"},"`")]),s("span",{class:"token punctuation"},")"),s("span",{class:"token punctuation"},";"),n(`
`)])]),s("span",{class:"token tag"},[s("span",{class:"token tag"},[s("span",{class:"token punctuation"},"</"),n("script")]),s("span",{class:"token punctuation"},">")]),n(`
`)])]),s("div",{class:"line-numbers","aria-hidden":"true"},[s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"}),s("div",{class:"line-number"})])],-1),h=u('<p>按照灰机的文档（或者说按照Moustache的官方文档），使用<code>{{参数}}</code>而不是<code>{{{参数}}}</code>可以避免可以避免注入攻击，但实际测试发现无论如何注入代码都会生效——网页弹出了两次提示，控制台两次显示了js处理过后的文字。</p><p>随后我在灰机wiki的QQ群内反馈，问题很快得到修复。</p><p><img src="'+k+'" alt="QQ聊天记录"></p><p>也就是说在以前，只要使用了<code>{{{参数}}}</code>或<code>{{参数}}</code>，所有可以编辑普通页面的用户就都拥有了开发者权限，也就是直接写入HTML的权限。</p><p>但是很快我们就发现，灰机的这个bug自古就有，因为很多灰机早期就出现的基础模板都“利用”了这个bug，我自己写的一些模板也存在问题。</p><p><img src="'+r+'" alt="“爱洗澡的大象”页面截图"></p><p>当然了，我们也不是故意利用漏洞的，写代码嘛，能用就行，谁知道代码运行的时候发生了什么呢？况且其中包括我在内的一些模板用的是<code>{{参数}}</code>，按照灰机的文档来说这就是安全的。</p><p>不过我现在非常后悔了，因为灰机修好这个bug后，我就有更多的bug要处理了，已经有人来催我了……</p><p><img src="'+d+'" alt="快修bug！"></p><p>况且，灰机的这个bug存在这么多年了，可以说是无事发生。毕竟对于灰机来说，内容为王，只需要简单地爬取灰机的原创内容，灰机就没有利用价值了，谁没事来搞什么注入攻击呢？最多也就是盗取“机长”也就是wiki负责人的账号，然后向灰机申请提取该wiki得到的捐赠资金——且不说大部分钱都很少，wiki内交流本来就不方便，大部分时间灰机职员都在QQ群与大家交流，除非QQ号一起被盗，否则这么做根本没有意义。</p><p>好了，不写了，修bug去了。</p>',11);function f(w,j){const e=c("CodeGroupItem"),o=c("CodeGroup");return l(),i("div",null,[m,_,a(o,null,{default:t(()=>[a(e,{title:"普通WIKI页面"},{default:t(()=>[v]),_:1}),a(e,{title:"HTML页面"},{default:t(()=>[b]),_:1})]),_:1}),h])}const x=p(g,[["render",f],["__file","2023-02-06.html.vue"]]);export{x as default};
